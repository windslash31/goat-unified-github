/*! For license information please see 435.e963377d.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkemployee_access_dashboard=self.webpackChunkemployee_access_dashboard||[]).push([[435],{4435:(e,s,a)=>{a.r(s),a.d(s,{RoleManagementPage:()=>w});var r=a(9479),i=a(5376),l=a(8304),t=a(6322),n=a(5702);const o=(0,a(5635).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var d=a(2478),c=a(1871),m=a(5338),p=a(5838),h=a(3580),u=a(3686),g=a(1325),x=a(1660);const y=[{title:"Application Access",permissions:[{name:"dashboard:view",description:"Allows viewing the main dashboard page."},{name:"profile:read:own",description:"Allows user to view their own profile page."},{name:"admin:view_users",description:"Allows viewing the User Management page."},{name:"admin:view_roles",description:"Allows viewing the Roles & Permissions page."}]},{title:"Employee Management",permissions:[{name:"employee:create",description:"Allows user to create new employee records."},{name:"employee:read:all",description:"Allows user to view all employees and their profiles."},{name:"employee:update",description:"Allows user to edit existing employee records."},{name:"employee:deactivate",description:"Allows user to manually suspend platform access."},{name:"employee:delete",description:"Allows user to delete an employee record."}]},{title:"User & Role Management",permissions:[{name:"user:create",description:"Allows creating a new user account."},{name:"user:update:role",description:"Allows assigning a role to a user on the User Management page."},{name:"user:delete",description:"Allows deleting a user account."},{name:"user:reset_password",description:"Allows an admin to reset another user's password."},{name:"role:manage",description:"Allows creating, deleting, and changing the permissions for a role."}]},{title:"Application Management",permissions:[{name:"admin:manage_applications",description:"Allows creating, updating, and deleting internal applications."}]},{title:"Auditing",permissions:[{name:"log:read",description:"Allows user to view the main activity log."},{name:"log:read:platform",description:"Allows user to view external platform logs (e.g., JumpCloud)."}]}],v=e=>{let{roles:s,selectedRole:a,handleSelectRole:r,permissions:i,openDeleteModal:n,newRoleName:o,setNewRoleName:d,handleCreateRole:c,isCreatingRole:m}=e;return(0,x.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[(0,x.jsxs)("div",{className:"p-4",children:[(0,x.jsx)("h2",{className:"font-semibold text-lg mb-3",children:"Roles"}),(0,x.jsx)("ul",{className:"space-y-1",children:s.map(e=>(0,x.jsx)("li",{children:(0,x.jsxs)("button",{onClick:()=>r(e),className:"w-full text-left px-3 py-2 rounded-md text-sm flex justify-between items-center ".concat((null===a||void 0===a?void 0:a.id)===e.id?"bg-kredivo-light text-kredivo-dark-text dark:bg-kredivo-primary/20 dark:text-kredivo-primary font-semibold":"hover:bg-gray-100 dark:hover:bg-gray-700/50"),children:[(0,x.jsx)("span",{children:e.name}),i.includes("role:manage")&&!["admin","viewer","auditor"].includes(e.name)&&(0,x.jsx)(l.A,{onClick:s=>{s.stopPropagation(),n(e)},className:"w-4 h-4 text-gray-400 hover:text-red-500"})]})},e.id))})]}),i.includes("role:manage")&&(0,x.jsxs)("form",{onSubmit:c,className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,x.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"New role name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 rounded-md focus:ring-2 focus:ring-kredivo-primary"}),(0,x.jsxs)(p.$,{type:"submit",disabled:m,className:"mt-2 w-full justify-center",children:[(0,x.jsx)(t.A,{className:"w-5 h-5 mr-2"})," ",m?"Creating...":"Create Role"]})]})]})},f=e=>{let{selectedRole:s,allPermissions:a,setIsMobileDetailView:r,handlePermissionChange:i,handleSaveChanges:l,hasUnsavedChanges:t,handleSelectAllGroup:d,isSaving:c}=e;const{user:m}=(0,h.n)(),u=(null===m||void 0===m?void 0:m.permissions)||[];return(0,x.jsx)("div",{className:"flex-1",children:s?(0,x.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full",children:[(0,x.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center",children:[(0,x.jsx)("button",{onClick:()=>r(!1),className:"md:hidden p-1 mr-2 -ml-1 text-gray-500",children:(0,x.jsx)(n.A,{})}),(0,x.jsxs)("h2",{className:"font-semibold text-lg",children:["Permissions for '",s.name,"'"]})]}),(0,x.jsx)("div",{className:"p-6 space-y-6 flex-grow overflow-y-auto",children:y.map(e=>{const r=e.permissions.filter(e=>a.some(s=>s.name===e.name));if(0===r.length)return null;const l=r.map(e=>{var s;return null===(s=a.find(s=>s.name===e.name))||void 0===s?void 0:s.id}).filter(Boolean),t=l.every(e=>s.permissions.some(s=>s.id===e));return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,x.jsx)("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-200",children:e.title}),(0,x.jsxs)("label",{className:"flex items-center text-sm",children:[(0,x.jsx)("input",{type:"checkbox",onChange:()=>d(l,!t),checked:t,className:"h-4 w-4 rounded border-gray-300 text-kredivo-primary focus:ring-kredivo-primary accent-kredivo-primary"}),(0,x.jsx)("span",{className:"ml-2",children:"Select All"})]})]}),(0,x.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:r.map(e=>{const r=a.find(s=>s.name===e.name);return r?(0,x.jsxs)("label",{className:"flex items-start p-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",children:[(0,x.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-kredivo-primary focus:ring-kredivo-primary mt-1 accent-kredivo-primary",checked:s.permissions.some(e=>e.id===r.id),onChange:e=>i(r.id,e.target.checked)}),(0,x.jsxs)("div",{className:"ml-3",children:[(0,x.jsx)("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:e.name}),(0,x.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]})]},r.id):null})})]},e.title)})}),u.includes("role:manage")&&(0,x.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-end",children:(0,x.jsxs)(p.$,{onClick:l,disabled:!t||c,variant:"primary",children:[(0,x.jsx)(o,{className:"w-4 h-4 mr-2"})," ",c?"Saving...":"Save Changes"]})})]}):(0,x.jsx)("div",{className:"text-center p-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:(0,x.jsx)("p",{children:"Select a role to view its permissions."})})})},w=e=>{let{onLogout:s}=e;const{user:a}=(0,h.n)(),l=(null===a||void 0===a?void 0:a.permissions)||[],[t,n]=(0,i.useState)([]),[o,p]=(0,i.useState)([]),[y,w]=(0,i.useState)(!0),[b,j]=(0,i.useState)(""),[k,N]=(0,i.useState)(null),[A,C]=(0,i.useState)(""),[S,R]=(0,i.useState)(!1),[M,P]=(0,i.useState)(null),[_,D]=(0,i.useState)(!1),[E,V]=(0,i.useState)(!1),[U,$]=(0,i.useState)(!1),[H,I]=(0,i.useState)(!1),z=(0,i.useCallback)(async()=>{w(!0);try{const[e,s]=await Promise.all([u.A.get("/api/roles/with-permissions"),u.A.get("/api/roles/permissions")]);n(e.data),p(s.data)}catch(e){console.error("Error:",e),j(e.message||"An unknown error occurred.")}finally{w(!1)}},[]);(0,i.useEffect)(()=>{z()},[z]),(0,i.useEffect)(()=>{if(!k&&t.length>0){const e=t.find(e=>e.id===(null===k||void 0===k?void 0:k.id))||t[0];N(e)}},[t,k]);return y?(0,x.jsx)("div",{className:"p-6 text-center",children:"Loading Roles & Permissions..."}):b?(0,x.jsxs)("div",{className:"p-6 text-center text-red-500",children:[(0,x.jsx)(d.A,{className:"mx-auto w-12 h-12 mb-4"}),(0,x.jsx)("h2",{className:"text-xl font-semibold",children:"Could not load data"}),(0,x.jsx)("p",{children:b})]}):(0,x.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"p-6 h-full flex flex-col",children:[(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Roles & Permissions"}),(0,x.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Manage what users can see and do."})]}),(0,x.jsxs)("div",{className:"flex-1 md:flex md:gap-6",children:[(0,x.jsx)("div",{className:"md:w-1/3 lg:w-1/4 ".concat(E?"hidden":"block"," md:block"),children:(0,x.jsx)(v,{roles:t,selectedRole:k,handleSelectRole:e=>{_&&!window.confirm("You have unsaved changes. Are you sure you want to discard them and switch roles?")||(N(e),D(!1),window.innerWidth<768&&V(!0))},permissions:l,openDeleteModal:e=>{P(e),R(!0)},newRoleName:A,setNewRoleName:C,handleCreateRole:async e=>{if(e.preventDefault(),A.trim()){I(!0);try{await u.A.post("/api/roles",{name:A.trim()}),c.Ay.success("Role created successfully!"),C(""),z()}catch(b){c.Ay.error("Could not create role.")}finally{I(!1)}}},isCreatingRole:H})}),(0,x.jsx)("div",{className:"flex-1 ".concat(E?"block":"hidden"," md:block"),children:(0,x.jsx)(f,{selectedRole:k,allPermissions:o,setIsMobileDetailView:V,handlePermissionChange:(e,s)=>{if(!k)return;D(!0);const a=s?[...k.permissions,o.find(s=>s.id===e)]:k.permissions.filter(s=>s.id!==e);N((0,r.A)((0,r.A)({},k),{},{permissions:a}))},handleSaveChanges:async()=>{if(!k||!_)return;$(!0);const e=k.permissions.map(e=>e.id);try{await u.A.put("/api/roles/".concat(k.id,"/permissions"),{permissionIds:e}),c.Ay.success("Permissions saved successfully!"),D(!1),z()}catch(b){c.Ay.error("Could not save permissions.")}finally{$(!1)}},hasUnsavedChanges:_,handleSelectAllGroup:(e,s)=>{if(!k)return;D(!0);const a=new Set(k.permissions.map(e=>e.id));s?e.forEach(e=>a.add(e)):e.forEach(e=>a.delete(e));const i=o.filter(e=>a.has(e.id));N((0,r.A)((0,r.A)({},k),{},{permissions:i}))},isSaving:U})})]}),(0,x.jsx)(m.R,{isOpen:S,onClose:()=>R(!1),onConfirm:async()=>{if(M)try{await u.A.delete("/api/roles/".concat(M.id)),c.Ay.success("Role deleted successfully!"),(null===k||void 0===k?void 0:k.id)===M.id&&(N(null),V(!1)),z()}catch(b){var e,s;c.Ay.error((null===(e=b.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Could not delete role.")}finally{R(!1),P(null)}},title:"Delete Role",message:'Are you sure you want to delete the role "'.concat(null===M||void 0===M?void 0:M.name,'"? This action cannot be undone.')})]})}},5338:(e,s,a)=>{a.d(s,{R:()=>o});a(5376);var r=a(2478),i=a(5838),l=a(9579),t=a(1325),n=a(1660);const o=e=>{let{isOpen:s,onClose:a,onConfirm:o,title:d,message:c}=e;return(0,n.jsx)(l.N,{children:s&&(0,n.jsx)(t.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,n.jsxs)(t.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-sm",children:[(0,n.jsxs)("div",{className:"p-6 text-center",children:[(0,n.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/20",children:(0,n.jsx)(r.A,{className:"h-6 w-6 text-red-600","aria-hidden":"true"})}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-white",children:d}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c})})]})]}),(0,n.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 px-4 py-4 sm:px-6 flex flex-col-reverse sm:flex-row sm:justify-end gap-3",children:[(0,n.jsx)(i.$,{onClick:a,variant:"secondary",className:"w-full justify-center sm:w-auto",children:"Cancel"}),(0,n.jsx)(i.$,{onClick:o,variant:"danger",className:"w-full justify-center sm:w-auto",children:"Confirm"})]})]})})})}},6322:(e,s,a)=>{a.d(s,{A:()=>r});const r=(0,a(5635).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},8304:(e,s,a)=>{a.d(s,{A:()=>r});const r=(0,a(5635).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}}]);
//# sourceMappingURL=435.e963377d.chunk.js.map