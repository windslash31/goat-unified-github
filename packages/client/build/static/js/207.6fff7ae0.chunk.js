"use strict";(self.webpackChunkemployee_access_dashboard=self.webpackChunkemployee_access_dashboard||[]).push([[207],{9207:(e,s,a)=>{a.r(s),a.d(s,{ProfilePage:()=>R});var r=a(1882),t=a(2176),i=a(624),l=a(7993),d=a(4032),o=a(9869),n=a(9644),c=a(3311),m=a(2841),x=a(8898),h=a(8596),p=a(3442),g=a(7419),y=a(3778),u=a(812);const b=e=>{let{user:s}=e;return(0,u.jsx)("div",{className:"p-6 text-center",children:(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 max-w-lg mx-auto p-8",children:[(0,u.jsx)(y.A,{className:"mx-auto w-16 h-16 text-blue-500"}),(0,u.jsxs)("h2",{className:"mt-6 text-2xl font-bold text-gray-900 dark:text-white",children:["Welcome, ",s.name,"!"]}),(0,u.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Your user account is active and you are successfully logged in."}),(0,u.jsx)("div",{className:"mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-yellow-800 dark:text-yellow-300",children:(0,u.jsx)("p",{className:"font-semibold",children:"Your employee profile has not been created in the system yet. Please contact an IT administrator to set up your employee record."})})]})})};var w=a(4718),j=a(994),f=a(1356),v=a(6158),N=a(9889),k=a(4079),P=a(8146);const A=e=>{let{onClose:s}=e;const[a,i]=(0,t.useState)({oldPassword:"",newPassword:"",confirmPassword:""}),[l,d]=(0,t.useState)(""),[o,n]=(0,t.useState)(!1),c=e=>{const{name:s,value:a}=e.target;i(e=>(0,r.A)((0,r.A)({},e),{},{[s]:a}))};return(0,u.jsx)(k.N,{children:(0,u.jsx)(P.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,u.jsx)(P.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:(0,u.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d(""),a.newPassword===a.confirmPassword){n(!0);try{const{oldPassword:e,newPassword:r}=a;await N.A.post("/api/users/change-password",{oldPassword:e,newPassword:r}),v.Ay.success("Password changed successfully!"),s()}catch(i){var r,t;d((null===(r=i.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.message)||"An error occurred.")}finally{n(!1)}}else d("New passwords do not match.")},children:[(0,u.jsxs)("div",{className:"p-6",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Change Password"}),(0,u.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"oldPassword",children:"Old Password"}),(0,u.jsx)("input",{type:"password",name:"oldPassword",id:"oldPassword",required:!0,value:a.oldPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"newPassword",children:"New Password"}),(0,u.jsx)("input",{type:"password",name:"newPassword",id:"newPassword",required:!0,value:a.newPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,u.jsx)("input",{type:"password",name:"confirmPassword",id:"confirmPassword",required:!0,value:a.confirmPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,u.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[(0,u.jsx)("p",{className:"font-semibold",children:"Password must meet the following requirements:"}),(0,u.jsx)("ul",{className:"list-disc list-inside",children:["At least 8 characters long","Contains at least one uppercase letter","Contains at least one lowercase letter","Contains at least one number","Contains at least one special character"].map(e=>(0,u.jsx)("li",{children:e},e))})]}),l&&(0,u.jsx)("p",{className:"text-sm text-red-500",children:l})]})]}),(0,u.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-6 py-3 flex justify-end gap-3",children:[(0,u.jsx)(f.$,{type:"button",onClick:s,disabled:o,variant:"secondary",children:"Cancel"}),(0,u.jsx)(f.$,{type:"submit",disabled:o,variant:"primary",children:o?"Saving...":"Save Changes"})]})]})})})})};var S=a(7507),C=a(1259),_=a(5798),T=a(3985),E=a(4142);const L=e=>{let{className:s}=e;return(0,u.jsx)("div",{className:"bg-gray-200 dark:bg-gray-700 rounded ".concat(s)})},O=()=>(0,u.jsxs)("div",{className:"p-4 sm:p-6 animate-pulse",children:[(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 sm:p-6 flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center",children:[(0,u.jsx)(L,{className:"w-16 h-16 rounded-full"}),(0,u.jsxs)("div",{className:"ml-4 space-y-2",children:[(0,u.jsx)(L,{className:"h-6 w-48"}),(0,u.jsx)(L,{className:"h-4 w-64"}),(0,u.jsx)(L,{className:"h-6 w-20 mt-1"})]})]}),(0,u.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[(0,u.jsx)(L,{className:"h-10 w-28"}),(0,u.jsx)(L,{className:"h-10 w-40"})]})]}),(0,u.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,u.jsx)(L,{className:"h-5 w-32 mb-4"}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsx)(L,{className:"h-4 w-full"}),(0,u.jsx)(L,{className:"h-4 w-5/6"}),(0,u.jsx)(L,{className:"h-4 w-full"})]})]}),(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,u.jsx)(L,{className:"h-5 w-40 mb-4"}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsx)(L,{className:"h-4 w-full"}),(0,u.jsx)(L,{className:"h-4 w-4/5"}),(0,u.jsx)(L,{className:"h-4 w-full"}),(0,u.jsx)(L,{className:"h-4 w-3/4"})]})]})]}),(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,u.jsx)(L,{className:"h-5 w-24 mb-4"}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsx)(L,{className:"h-4 w-full"}),(0,u.jsx)(L,{className:"h-4 w-5/6"}),(0,u.jsx)(L,{className:"h-4 w-full"})]})]}),(0,u.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,u.jsx)(L,{className:"h-5 w-36 mb-4"}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsx)(L,{className:"h-4 w-full"}),(0,u.jsx)(L,{className:"h-4 w-4/6"})]})]})]})]})]}),D=async()=>{const{data:e}=await N.A.get("/api/me");return e},R=e=>{let{employee:s,permissions:a,onEdit:y,onDeactivate:v,onLogout:N,user:L}=e;const{isAuthenticated:R}=(0,E.n)(),[z,I]=(0,t.useState)("details"),[F,U]=(0,t.useState)([]),[K,W]=(0,t.useState)(!0),[q,B]=(0,t.useState)(!1),[H,$]=(0,t.useState)({timeline:{data:null,loading:!1,error:null,fetched:!1}}),[M,V]=(0,t.useState)(!1),[Y,Z]=(0,t.useState)(null),[G,J]=(0,t.useState)(!1),Q=(0,t.useRef)(null),X=(0,_.U)("(min-width: 768px)"),{data:ee,isLoading:se}=(0,T.I)({queryKey:["me"],queryFn:D,enabled:R,staleTime:3e5}),ae=[{id:"details",label:"Details",icon:(0,u.jsx)(i.A,{size:16}),permission:!0},{id:"devices",label:"Devices",icon:(0,u.jsx)(l.A,{size:16}),permission:!0},{id:"platforms",label:"Apps & Platforms",shortLabel:"Access",icon:(0,u.jsx)(d.A,{size:16}),permission:!0},{id:"platform-logs",label:"Platform Logs",shortLabel:"Logs",icon:(0,u.jsx)(o.A,{size:16}),permission:a.includes("log:read:platform")},{id:"timeline",label:"Unified Timeline",shortLabel:"Timeline",icon:(0,u.jsx)(n.A,{size:16}),permission:a.includes("log:read:platform")}].filter(e=>e.permission),re=X?ae:ae.slice(0,3),te=X?[]:ae.slice(3),ie=te.some(e=>e.id===z);(0,t.useEffect)(()=>{const e=e=>{Q.current&&!Q.current.contains(e.target)&&J(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const le=(0,t.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!s||!a.includes("log:read:platform")||!e&&(H.timeline.fetched||H.timeline.loading))return;const t=localStorage.getItem("accessToken");let i="".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL,"/api/employees/").concat(s.id,"/unified-timeline");$(e=>(0,r.A)((0,r.A)({},e),{},{timeline:(0,r.A)((0,r.A)({},e.timeline),{},{loading:!0})})),fetch(i,{headers:{Authorization:"Bearer ".concat(t)}}).then(e=>e.ok?e.json():e.json().then(e=>Promise.reject(e))).then(e=>{$(s=>(0,r.A)((0,r.A)({},s),{},{timeline:{data:e,loading:!1,error:null,fetched:!0}}))}).catch(e=>{$(s=>(0,r.A)((0,r.A)({},s),{},{timeline:{data:[],loading:!1,error:e.message,fetched:!0}}))})},[s,a,H.timeline]),de=(0,t.useCallback)(async()=>{if(!s)return;const e=localStorage.getItem("accessToken");e?(W(!0),fetch("".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL,"/api/employees/").concat(s.id,"/platform-statuses"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():[]).then(e=>U(e)).catch(e=>console.error("Failed to fetch platform statuses:",e)).finally(()=>W(!1))):N()},[s,N]);(0,t.useEffect)(()=>{s&&de()},[s,de]),(0,t.useEffect)(()=>{s&&"timeline"===z&&le()},[s,z,le]);const oe=e=>{I(e),J(!1)},ne=e=>{e&&(Z(e),V(!0))};if(se)return(0,u.jsx)(O,{});if(!a.includes("profile:read:own"))return(0,u.jsx)(w.p,{});if(!s)return(0,u.jsx)(b,{user:L});const ce=e=>{let{id:s,label:a,shortLabel:r,icon:t}=e;return(0,u.jsxs)("button",{onClick:()=>oe(s),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(z===s?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[t," ",X?a:r||a]})},me=(0,u.jsxs)("div",{className:"mt-6",children:["details"===z&&(0,u.jsx)(h.g,{employee:s,permissions:a,onTicketClick:ne}),"devices"===z&&(0,u.jsx)(C.v,{employeeId:s.id}),"platforms"===z&&(0,u.jsx)(p.z,{applications:s.applications||[],platformStatuses:F,isLoading:K,onTicketClick:ne}),"platform-logs"===z&&(0,u.jsx)(S.v,{employeeId:s.id,onLogout:N}),"timeline"===z&&(0,u.jsx)(j.n,{events:H.timeline.data,loading:H.timeline.loading,error:H.timeline.error})]});return(0,u.jsxs)(P.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between md:items-center",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"My Profile"}),(0,u.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"This is your personal employee record and application access list."})]}),(0,u.jsxs)(f.$,{onClick:()=>B(!0),variant:"secondary",className:"mt-4 md:mt-0",children:[(0,u.jsx)(c.A,{className:"w-4 h-4 mr-2"})," Change Password"]})]}),(0,u.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,u.jsx)(x.Z,{employee:s,onEdit:y,onDeactivate:v,permissions:a,isOwnProfile:!0}),(0,u.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)("nav",{className:"-mb-px flex items-center overflow-x-auto","aria-label":"Tabs",children:re.map(e=>(0,u.jsx)(ce,(0,r.A)({},e),e.id))}),te.length>0&&(0,u.jsxs)("div",{ref:Q,className:"relative ml-auto pl-2",children:[(0,u.jsxs)("button",{onClick:()=>J(e=>!e),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(ie?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,u.jsx)(m.A,{size:16})," More"]}),(0,u.jsx)(k.N,{children:G&&(0,u.jsx)(P.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:(0,u.jsx)("div",{className:"py-1",children:te.map(e=>(0,u.jsxs)("button",{onClick:()=>oe(e.id),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm ".concat(z===e.id?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.icon," ",e.shortLabel||e.label]},e.id))})})})]})]})}),me]})]}),M&&(0,u.jsx)(g.S,{ticketId:Y,onClose:()=>V(!1)}),q&&(0,u.jsx)(A,{onClose:()=>B(!1)})]})}}}]);
//# sourceMappingURL=207.6fff7ae0.chunk.js.map