"use strict";(self.webpackChunkemployee_access_dashboard=self.webpackChunkemployee_access_dashboard||[]).push([[133],{6133:(e,s,a)=>{a.r(s),a.d(s,{ProfilePage:()=>z});var t=a(9479),r=a(5376),i=a(1952),o=a(1689),l=a(1712),n=a(9901),d=a(6460),c=a(6991),m=a(1721),p=a(4868),x=a(7080),h=a(354),u=a(4481),g=a(9154),y=a(1660);const b=e=>{let{user:s}=e;return(0,y.jsx)("div",{className:"p-6 text-center",children:(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 max-w-lg mx-auto p-8",children:[(0,y.jsx)(g.A,{className:"mx-auto w-16 h-16 text-blue-500"}),(0,y.jsxs)("h2",{className:"mt-6 text-2xl font-bold text-gray-900 dark:text-white",children:["Welcome, ",s.name,"!"]}),(0,y.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Your user account is active and you are successfully logged in."}),(0,y.jsx)("div",{className:"mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-yellow-800 dark:text-yellow-300",children:(0,y.jsx)("p",{className:"font-semibold",children:"Your employee profile has not been created in the system yet. Please contact an IT administrator to set up your employee record."})})]})})};var f=a(7196),w=a(4608),j=a(5838),v=a(1871),k=a(3686),N=a(9579),P=a(1325);const A=e=>{let{onClose:s}=e;const[a,i]=(0,r.useState)({oldPassword:"",newPassword:"",confirmPassword:""}),[o,l]=(0,r.useState)(""),[n,d]=(0,r.useState)(!1),c=e=>{const{name:s,value:a}=e.target;i(e=>(0,t.A)((0,t.A)({},e),{},{[s]:a}))};return(0,y.jsx)(N.N,{children:(0,y.jsx)(P.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,y.jsx)(P.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:(0,y.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l(""),a.newPassword===a.confirmPassword){d(!0);try{const{oldPassword:e,newPassword:t}=a;await k.A.post("/api/users/change-password",{oldPassword:e,newPassword:t}),v.Ay.success("Password changed successfully!"),s()}catch(i){var t,r;l((null===(t=i.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"An error occurred.")}finally{d(!1)}}else l("New passwords do not match.")},children:[(0,y.jsxs)("div",{className:"p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Change Password"}),(0,y.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"oldPassword",children:"Old Password"}),(0,y.jsx)("input",{type:"password",name:"oldPassword",id:"oldPassword",required:!0,value:a.oldPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"newPassword",children:"New Password"}),(0,y.jsx)("input",{type:"password",name:"newPassword",id:"newPassword",required:!0,value:a.newPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,y.jsx)("input",{type:"password",name:"confirmPassword",id:"confirmPassword",required:!0,value:a.confirmPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[(0,y.jsx)("p",{className:"font-semibold",children:"Password must meet the following requirements:"}),(0,y.jsx)("ul",{className:"list-disc list-inside",children:["At least 8 characters long","Contains at least one uppercase letter","Contains at least one lowercase letter","Contains at least one number","Contains at least one special character"].map(e=>(0,y.jsx)("li",{children:e},e))})]}),o&&(0,y.jsx)("p",{className:"text-sm text-red-500",children:o})]})]}),(0,y.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-6 py-3 flex justify-end gap-3",children:[(0,y.jsx)(j.$,{type:"button",onClick:s,disabled:n,variant:"secondary",children:"Cancel"}),(0,y.jsx)(j.$,{type:"submit",disabled:n,variant:"primary",children:n?"Saving...":"Save Changes"})]})]})})})})};var C=a(9395),S=a(1982),L=a(292);const z=e=>{let{employee:s,permissions:a,onEdit:g,onDeactivate:v,onLogout:k,user:z}=e;const[T,E]=(0,r.useState)("details"),[I,D]=(0,r.useState)([]),[q,F]=(0,r.useState)(!0),[_,$]=(0,r.useState)(!1),[B,M]=(0,r.useState)({timeline:{data:null,loading:!1,error:null,fetched:!1}}),[O,U]=(0,r.useState)(!1),[Y,R]=(0,r.useState)(null),[W,Z]=(0,r.useState)(!1),G=(0,r.useRef)(null),H=(0,L.U)("(min-width: 768px)"),J=[{id:"details",label:"Details",icon:(0,y.jsx)(i.A,{size:16}),permission:!0},{id:"devices",label:"Devices",icon:(0,y.jsx)(o.A,{size:16}),permission:!0},{id:"platforms",label:"Apps & Platforms",shortLabel:"Access",icon:(0,y.jsx)(l.A,{size:16}),permission:!0},{id:"platform-logs",label:"Platform Logs",shortLabel:"Logs",icon:(0,y.jsx)(n.A,{size:16}),permission:a.includes("log:read:platform")},{id:"timeline",label:"Unified Timeline",shortLabel:"Timeline",icon:(0,y.jsx)(d.A,{size:16}),permission:a.includes("log:read:platform")}].filter(e=>e.permission),K=H?J:J.slice(0,3),Q=H?[]:J.slice(3),V=Q.some(e=>e.id===T);(0,r.useEffect)(()=>{const e=e=>{G.current&&!G.current.contains(e.target)&&Z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const X=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!s||!a.includes("log:read:platform")||!e&&(B.timeline.fetched||B.timeline.loading))return;const r=localStorage.getItem("accessToken");let i="".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(s.id,"/unified-timeline");M(e=>(0,t.A)((0,t.A)({},e),{},{timeline:(0,t.A)((0,t.A)({},e.timeline),{},{loading:!0})})),fetch(i,{headers:{Authorization:"Bearer ".concat(r)}}).then(e=>e.ok?e.json():e.json().then(e=>Promise.reject(e))).then(e=>{M(s=>(0,t.A)((0,t.A)({},s),{},{timeline:{data:e,loading:!1,error:null,fetched:!0}}))}).catch(e=>{M(s=>(0,t.A)((0,t.A)({},s),{},{timeline:{data:[],loading:!1,error:e.message,fetched:!0}}))})},[s,a,B.timeline]),ee=(0,r.useCallback)(async()=>{if(!s)return;const e=localStorage.getItem("accessToken");e?(F(!0),fetch("".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(s.id,"/platform-statuses"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():[]).then(e=>D(e)).catch(e=>console.error("Failed to fetch platform statuses:",e)).finally(()=>F(!1))):k()},[s,k]);(0,r.useEffect)(()=>{s&&ee()},[s,ee]),(0,r.useEffect)(()=>{s&&"timeline"===T&&X()},[s,T,X]);const se=e=>{E(e),Z(!1)},ae=e=>{e&&(R(e),U(!0))};if(!a.includes("profile:read:own"))return(0,y.jsx)(f.p,{});if(!s)return(0,y.jsx)(b,{user:z});const te=e=>{let{id:s,label:a,shortLabel:t,icon:r}=e;return(0,y.jsxs)("button",{onClick:()=>se(s),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(T===s?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[r," ",H?a:t||a]})},re=(0,y.jsxs)("div",{className:"mt-6",children:["details"===T&&(0,y.jsx)(x.g,{employee:s,permissions:a,onTicketClick:ae}),"devices"===T&&(0,y.jsx)(S.v,{employeeId:s.id}),"platforms"===T&&(0,y.jsx)(h.z,{applications:s.applications||[],platformStatuses:I,isLoading:q,onTicketClick:ae}),"platform-logs"===T&&(0,y.jsx)(C.v,{employeeId:s.id,onLogout:k}),"timeline"===T&&(0,y.jsx)(w.n,{events:B.timeline.data,loading:B.timeline.loading,error:B.timeline.error})]});return(0,y.jsxs)(P.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between md:items-center",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"My Profile"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"This is your personal employee record and application access list."})]}),(0,y.jsxs)(j.$,{onClick:()=>$(!0),variant:"secondary",className:"mt-4 md:mt-0",children:[(0,y.jsx)(c.A,{className:"w-4 h-4 mr-2"})," Change Password"]})]}),(0,y.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,y.jsx)(p.Z,{employee:s,onEdit:g,onDeactivate:v,permissions:a,isOwnProfile:!0}),(0,y.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,y.jsxs)("div",{className:"flex justify-between items-center",children:[(0,y.jsx)("nav",{className:"-mb-px flex items-center overflow-x-auto","aria-label":"Tabs",children:K.map(e=>(0,y.jsx)(te,(0,t.A)({},e),e.id))}),Q.length>0&&(0,y.jsxs)("div",{ref:G,className:"relative ml-auto pl-2",children:[(0,y.jsxs)("button",{onClick:()=>Z(e=>!e),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(V?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,y.jsx)(m.A,{size:16})," More"]}),(0,y.jsx)(N.N,{children:W&&(0,y.jsx)(P.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:(0,y.jsx)("div",{className:"py-1",children:Q.map(e=>(0,y.jsxs)("button",{onClick:()=>se(e.id),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm ".concat(T===e.id?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.icon," ",e.shortLabel||e.label]},e.id))})})})]})]})}),re]})]}),O&&(0,y.jsx)(u.S,{ticketId:Y,onClose:()=>U(!1)}),_&&(0,y.jsx)(A,{onClose:()=>$(!1)})]})}}}]);
//# sourceMappingURL=133.220cb0e5.chunk.js.map