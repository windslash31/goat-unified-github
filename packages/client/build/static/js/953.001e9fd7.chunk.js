/*! For license information please see 953.001e9fd7.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkemployee_access_dashboard=self.webpackChunkemployee_access_dashboard||[]).push([[953],{8953:(e,t,s)=>{s.r(t),s.d(t,{EmployeeDetailPage:()=>B});var a=s(9479),i=s(5376),r=s(9163),l=s(1952),o=s(1689),n=s(1712),c=s(5635);const d=(0,c.A)("BookLock",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H10",key:"18wgow"}],["path",{d:"M20 15v7H6.5a2.5 2.5 0 0 1 0-5H20",key:"dpch1j"}],["rect",{width:"8",height:"5",x:"12",y:"6",rx:"1",key:"9nqwug"}],["path",{d:"M18 6V4a2 2 0 1 0-4 0v2",key:"1aquzs"}]]);var m=s(9901),p=s(6460),h=s(2478),x=s(1721),u=s(4008),g=s(4868),y=s(7080),f=s(354),j=s(4481),b=s(6608),v=s(3686),k=s(9467),w=s(1616);const N=(0,c.A)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var A=s(1660);const L={google:"Google Workspace",jumpcloud:"JumpCloud",slack:"Slack",atlassian:"Atlassian (Jira/Confluence)"},S=e=>{let{status:t}=e;switch(t){case"Licensed":case"Active":return(0,A.jsx)(k.A,{className:"w-5 h-5 text-green-500"});case"Not Licensed":case"Suspended":case"Deactivated":case"Inactive":return(0,A.jsx)(w.A,{className:"w-5 h-5 text-red-500"});case"Error":return(0,A.jsx)(h.A,{className:"w-5 h-5 text-yellow-500"});default:return(0,A.jsx)(N,{className:"w-5 h-5 text-gray-400"})}},C=e=>{let{platform:t,license:s}=e;return(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[(0,A.jsxs)("div",{className:"flex items-center",children:[(0,A.jsx)(S,{status:s.status}),(0,A.jsxs)("div",{className:"ml-3",children:[(0,A.jsx)("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:L[t]}),(0,A.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.status})]})]}),s.details&&Object.keys(s.details).length>0&&(0,A.jsxs)("div",{className:"text-right text-sm",children:[s.details.is_guest&&(0,A.jsx)("span",{className:"font-medium text-blue-500",children:"Guest Account"}),s.details.products&&s.details.products.map(e=>(0,A.jsx)("div",{className:"text-gray-500",children:e},e)),Array.isArray(s.details)&&s.details.map(e=>(0,A.jsx)("div",{className:"text-gray-500",children:e.plan},e.sku))]})]})},z=e=>{let{employeeId:t}=e;const{data:s,isLoading:a,error:i}=(0,b.I)({queryKey:["employeeLicenses",t],queryFn:()=>(async e=>{const{data:t}=await v.A.get("/api/employees/".concat(e,"/licenses"));return t})(t)});return a?(0,A.jsx)("div",{className:"text-center p-6",children:"Loading license details..."}):i?(0,A.jsx)("div",{className:"text-center p-6 text-red-500",children:"Could not fetch license details."}):(0,A.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,A.jsx)("div",{className:"space-y-4",children:s.map(e=>(0,A.jsx)(C,{platform:e.platform,license:e},e.platform))})})};var E=s(4608),I=s(9395),T=s(1982),_=s(9579),D=s(1325),P=s(292);const B=e=>{let{onEdit:t,onDeactivate:s,permissions:c,onLogout:b}=e;const{employeeId:v}=(0,r.g)(),k=(0,r.Zp)(),{setDynamicCrumbs:w}=(0,u.r)(),[N,L]=(0,i.useState)(null),[S,C]=(0,i.useState)(!0),[B,M]=(0,i.useState)(null),[F,q]=(0,i.useState)("details"),[H,O]=(0,i.useState)([]),[J,G]=(0,i.useState)(!0),[U,Z]=(0,i.useState)(!1),K=(0,i.useRef)(null),R=(0,P.U)("(min-width: 768px)"),[V,W]=(0,i.useState)({timeline:{data:[],loading:!1,error:null,fetched:!1}}),[Q,X]=(0,i.useState)(!1),[Y,$]=(0,i.useState)(null),ee=[{id:"details",label:"Details",icon:(0,A.jsx)(l.A,{size:16}),permission:!0},{id:"devices",label:"Devices",icon:(0,A.jsx)(o.A,{size:16}),permission:!0},{id:"platforms",label:"Apps & Platforms",shortLabel:"Access",icon:(0,A.jsx)(n.A,{size:16}),permission:!0},{id:"licenses",label:"Licenses",icon:(0,A.jsx)(d,{size:16}),permission:!0},{id:"platform-logs",label:"Platform Logs",shortLabel:"Logs",icon:(0,A.jsx)(m.A,{size:16}),permission:c.includes("log:read:platform")},{id:"timeline",label:"Unified Timeline",shortLabel:"Timeline",icon:(0,A.jsx)(p.A,{size:16}),permission:c.includes("log:read:platform")}].filter(e=>e.permission),te=R?ee:ee.slice(0,3),se=R?[]:ee.slice(3),ae=se.some(e=>e.id===F);(0,i.useEffect)(()=>{const e=e=>{K.current&&!K.current.contains(e.target)&&Z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const ie=(0,i.useCallback)(()=>{const e=localStorage.getItem("accessToken");e?(C(!0),fetch("".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(v),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{if(404===e.status)throw new Error("Employee not found.");if(!e.ok)throw new Error("Failed to fetch employee profile.");return e.json()}).then(e=>{L(e);const t=[e.first_name,e.middle_name,e.last_name].filter(Boolean).join(" ");w([{name:"Employees",path:"/employees"},{name:t,path:"/employees/".concat(v)}])}).catch(e=>{console.error("Error fetching main employee data:",e),M(e.message)}).finally(()=>C(!1)),G(!0),fetch("".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(v,"/platform-statuses"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():[]).then(e=>O(e)).catch(e=>console.error("Failed to fetch platform statuses:",e)).finally(()=>G(!1))):b()},[v,b,w]);(0,i.useEffect)(()=>{ie();const e=localStorage.getItem("accessToken");return e&&v&&fetch("".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/logs/view"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({targetEmployeeId:v})}).catch(e=>console.error("Failed to log profile view:",e)),()=>{w([])}},[ie,w,v]);const re=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!v||!c.includes("log:read:platform")||!e&&(V.timeline.fetched||V.timeline.loading))return;const t=localStorage.getItem("accessToken");let s="".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(v,"/unified-timeline");W(e=>(0,a.A)((0,a.A)({},e),{},{timeline:(0,a.A)((0,a.A)({},e.timeline),{},{loading:!0})})),fetch(s,{headers:{Authorization:"Bearer ".concat(t)}}).then(e=>e.ok?e.json():e.json().then(e=>Promise.reject(e))).then(e=>{W(t=>(0,a.A)((0,a.A)({},t),{},{timeline:{data:e,loading:!1,error:null,fetched:!0}}))}).catch(e=>{W(t=>(0,a.A)((0,a.A)({},t),{},{timeline:{data:[],loading:!1,error:e.message,fetched:!0}}))})},[v,c,V.timeline]),le=e=>{q(e),Z(!1),"timeline"===e&&re()},oe=e=>{e&&($(e),X(!0))},ne=e=>{let{id:t,label:s,shortLabel:a,icon:i}=e;return(0,A.jsxs)("button",{onClick:()=>le(t),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(F===t?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[i," ",R?s:a||s]})},ce=(0,A.jsxs)("div",{className:"mt-6",children:["details"===F&&(0,A.jsx)(y.g,{employee:N,navigate:k,permissions:c,onTicketClick:oe}),"devices"===F&&(0,A.jsx)(T.v,{employeeId:v}),"platforms"===F&&(0,A.jsx)(f.z,{applications:N.applications||[],platformStatuses:H,isLoading:J,onTicketClick:oe}),"licenses"===F&&(0,A.jsx)(z,{employeeId:v}),"platform-logs"===F&&(0,A.jsx)(I.v,{employeeId:v,onLogout:b}),"timeline"===F&&(0,A.jsx)(E.n,{events:V.timeline.data,loading:V.timeline.loading,error:V.timeline.error})]});return S?(0,A.jsx)("div",{className:"p-6 text-center",children:"Loading employee profile..."}):B?(0,A.jsxs)("div",{className:"p-6 text-center text-red-500",children:[(0,A.jsx)(h.A,{className:"mx-auto w-12 h-12 mb-4"})," ",(0,A.jsx)("h2",{className:"text-xl font-semibold",children:"Could not load employee data"})," ",(0,A.jsx)("p",{children:B})," "]}):N?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,A.jsx)(g.Z,{employee:N,onEdit:t,onDeactivate:s,permissions:c,isOwnProfile:!1}),(0,A.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,A.jsxs)("div",{className:"flex justify-between items-center",children:[(0,A.jsx)("nav",{className:"-mb-px flex items-center overflow-x-auto","aria-label":"Tabs",children:te.map(e=>(0,A.jsx)(ne,(0,a.A)({},e),e.id))}),se.length>0&&(0,A.jsxs)("div",{ref:K,className:"relative ml-auto pl-2",children:[(0,A.jsxs)("button",{onClick:()=>Z(e=>!e),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(ae?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,A.jsx)(x.A,{size:16})," More"]}),(0,A.jsx)(_.N,{children:U&&(0,A.jsx)(D.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:(0,A.jsx)("div",{className:"py-1",children:se.map(e=>(0,A.jsxs)("button",{onClick:()=>le(e.id),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm ".concat(F===e.id?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.icon," ",e.shortLabel||e.label]},e.id))})})})]})]})}),ce]}),Q&&(0,A.jsx)(j.S,{ticketId:Y,onClose:()=>X(!1)})]}):null}}}]);
//# sourceMappingURL=953.001e9fd7.chunk.js.map