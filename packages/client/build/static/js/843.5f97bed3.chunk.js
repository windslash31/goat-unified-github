"use strict";(self.webpackChunkemployee_access_dashboard=self.webpackChunkemployee_access_dashboard||[]).push([[843],{6843:(e,s,a)=>{a.r(s),a.d(s,{ProfilePage:()=>q});var t=a(1882),r=a(2176),i=a(624),o=a(7993),n=a(4032),l=a(9869),d=a(9644),c=a(3311),m=a(2841),p=a(8898),x=a(8596),u=a(3442),h=a(7419),g=a(3778),y=a(812);const b=e=>{let{user:s}=e;return(0,y.jsx)("div",{className:"p-6 text-center",children:(0,y.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 max-w-lg mx-auto p-8",children:[(0,y.jsx)(g.A,{className:"mx-auto w-16 h-16 text-blue-500"}),(0,y.jsxs)("h2",{className:"mt-6 text-2xl font-bold text-gray-900 dark:text-white",children:["Welcome, ",s.name,"!"]}),(0,y.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Your user account is active and you are successfully logged in."}),(0,y.jsx)("div",{className:"mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-yellow-800 dark:text-yellow-300",children:(0,y.jsx)("p",{className:"font-semibold",children:"Your employee profile has not been created in the system yet. Please contact an IT administrator to set up your employee record."})})]})})};var f=a(4718),w=a(994),j=a(1356),v=a(6158),k=a(9889),N=a(4079),P=a(8146);const A=e=>{let{onClose:s}=e;const[a,i]=(0,r.useState)({oldPassword:"",newPassword:"",confirmPassword:""}),[o,n]=(0,r.useState)(""),[l,d]=(0,r.useState)(!1),c=e=>{const{name:s,value:a}=e.target;i(e=>(0,t.A)((0,t.A)({},e),{},{[s]:a}))};return(0,y.jsx)(N.N,{children:(0,y.jsx)(P.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,y.jsx)(P.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:(0,y.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),n(""),a.newPassword===a.confirmPassword){d(!0);try{const{oldPassword:e,newPassword:t}=a;await k.A.post("/api/users/change-password",{oldPassword:e,newPassword:t}),v.Ay.success("Password changed successfully!"),s()}catch(i){var t,r;n((null===(t=i.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"An error occurred.")}finally{d(!1)}}else n("New passwords do not match.")},children:[(0,y.jsxs)("div",{className:"p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Change Password"}),(0,y.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"oldPassword",children:"Old Password"}),(0,y.jsx)("input",{type:"password",name:"oldPassword",id:"oldPassword",required:!0,value:a.oldPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"newPassword",children:"New Password"}),(0,y.jsx)("input",{type:"password",name:"newPassword",id:"newPassword",required:!0,value:a.newPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,y.jsx)("input",{type:"password",name:"confirmPassword",id:"confirmPassword",required:!0,value:a.confirmPassword,onChange:c,className:"mt-1 w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"})]}),(0,y.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[(0,y.jsx)("p",{className:"font-semibold",children:"Password must meet the following requirements:"}),(0,y.jsx)("ul",{className:"list-disc list-inside",children:["At least 8 characters long","Contains at least one uppercase letter","Contains at least one lowercase letter","Contains at least one number","Contains at least one special character"].map(e=>(0,y.jsx)("li",{children:e},e))})]}),o&&(0,y.jsx)("p",{className:"text-sm text-red-500",children:o})]})]}),(0,y.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-6 py-3 flex justify-end gap-3",children:[(0,y.jsx)(j.$,{type:"button",onClick:s,disabled:l,variant:"secondary",children:"Cancel"}),(0,y.jsx)(j.$,{type:"submit",disabled:l,variant:"primary",children:l?"Saving...":"Save Changes"})]})]})})})})};var C=a(7507),S=a(1259),L=a(5798),z=a(3985),T=a(4142),E=a(4790);const I=async()=>{const{data:e}=await k.A.get("/api/me");return e},q=e=>{let{employee:s,permissions:a,onEdit:g,onDeactivate:v,onLogout:k,user:q}=e;const{isAuthenticated:D}=(0,T.n)(),[F,_]=(0,r.useState)("details"),[$,B]=(0,r.useState)([]),[M,O]=(0,r.useState)(!0),[U,Y]=(0,r.useState)(!1),[K,R]=(0,r.useState)({timeline:{data:null,loading:!1,error:null,fetched:!1}}),[W,Z]=(0,r.useState)(!1),[G,H]=(0,r.useState)(null),[J,Q]=(0,r.useState)(!1),V=(0,r.useRef)(null),X=(0,L.U)("(min-width: 768px)"),{data:ee,isLoading:se}=(0,z.I)({queryKey:["me"],queryFn:I,enabled:D,staleTime:3e5}),ae=[{id:"details",label:"Details",icon:(0,y.jsx)(i.A,{size:16}),permission:!0},{id:"devices",label:"Devices",icon:(0,y.jsx)(o.A,{size:16}),permission:!0},{id:"platforms",label:"Apps & Platforms",shortLabel:"Access",icon:(0,y.jsx)(n.A,{size:16}),permission:!0},{id:"platform-logs",label:"Platform Logs",shortLabel:"Logs",icon:(0,y.jsx)(l.A,{size:16}),permission:a.includes("log:read:platform")},{id:"timeline",label:"Unified Timeline",shortLabel:"Timeline",icon:(0,y.jsx)(d.A,{size:16}),permission:a.includes("log:read:platform")}].filter(e=>e.permission),te=X?ae:ae.slice(0,3),re=X?[]:ae.slice(3),ie=re.some(e=>e.id===F);(0,r.useEffect)(()=>{const e=e=>{V.current&&!V.current.contains(e.target)&&Q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const oe=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!s||!a.includes("log:read:platform")||!e&&(K.timeline.fetched||K.timeline.loading))return;const r=localStorage.getItem("accessToken");let i="".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(s.id,"/unified-timeline");R(e=>(0,t.A)((0,t.A)({},e),{},{timeline:(0,t.A)((0,t.A)({},e.timeline),{},{loading:!0})})),fetch(i,{headers:{Authorization:"Bearer ".concat(r)}}).then(e=>e.ok?e.json():e.json().then(e=>Promise.reject(e))).then(e=>{R(s=>(0,t.A)((0,t.A)({},s),{},{timeline:{data:e,loading:!1,error:null,fetched:!0}}))}).catch(e=>{R(s=>(0,t.A)((0,t.A)({},s),{},{timeline:{data:[],loading:!1,error:e.message,fetched:!0}}))})},[s,a,K.timeline]),ne=(0,r.useCallback)(async()=>{if(!s)return;const e=localStorage.getItem("accessToken");e?(O(!0),fetch("".concat("https://goat-backend-990004954390.asia-southeast2.run.app","/api/employees/").concat(s.id,"/platform-statuses"),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>e.ok?e.json():[]).then(e=>B(e)).catch(e=>console.error("Failed to fetch platform statuses:",e)).finally(()=>O(!1))):k()},[s,k]);(0,r.useEffect)(()=>{s&&ne()},[s,ne]),(0,r.useEffect)(()=>{s&&"timeline"===F&&oe()},[s,F,oe]);const le=e=>{_(e),Q(!1)},de=e=>{e&&(H(e),Z(!0))};if(se)return(0,y.jsx)(E.n,{});if(!a.includes("profile:read:own"))return(0,y.jsx)(f.p,{});if(!s)return(0,y.jsx)(b,{user:q});const ce=e=>{let{id:s,label:a,shortLabel:t,icon:r}=e;return(0,y.jsxs)("button",{onClick:()=>le(s),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(F===s?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[r," ",X?a:t||a]})},me=(0,y.jsxs)("div",{className:"mt-6",children:["details"===F&&(0,y.jsx)(x.g,{employee:s,permissions:a,onTicketClick:de}),"devices"===F&&(0,y.jsx)(S.v,{employeeId:s.id}),"platforms"===F&&(0,y.jsx)(u.z,{applications:s.applications||[],platformStatuses:$,isLoading:M,onTicketClick:de}),"platform-logs"===F&&(0,y.jsx)(C.v,{employeeId:s.id,onLogout:k}),"timeline"===F&&(0,y.jsx)(w.n,{events:K.timeline.data,loading:K.timeline.loading,error:K.timeline.error})]});return(0,y.jsxs)(P.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between md:items-center",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"My Profile"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"This is your personal employee record and application access list."})]}),(0,y.jsxs)(j.$,{onClick:()=>Y(!0),variant:"secondary",className:"mt-4 md:mt-0",children:[(0,y.jsx)(c.A,{className:"w-4 h-4 mr-2"})," Change Password"]})]}),(0,y.jsxs)("div",{className:"p-4 sm:p-6 space-y-6",children:[(0,y.jsx)(p.Z,{employee:s,onEdit:g,onDeactivate:v,permissions:a,isOwnProfile:!0}),(0,y.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,y.jsxs)("div",{className:"flex justify-between items-center",children:[(0,y.jsx)("nav",{className:"-mb-px flex items-center overflow-x-auto","aria-label":"Tabs",children:te.map(e=>(0,y.jsx)(ce,(0,t.A)({},e),e.id))}),re.length>0&&(0,y.jsxs)("div",{ref:V,className:"relative ml-auto pl-2",children:[(0,y.jsxs)("button",{onClick:()=>Q(e=>!e),className:"flex-shrink-0 flex items-center gap-2 py-3 px-4 border-b-2 font-semibold text-sm transition-colors whitespace-nowrap ".concat(ie?"border-kredivo-primary text-kredivo-primary":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,y.jsx)(m.A,{size:16})," More"]}),(0,y.jsx)(N.N,{children:J&&(0,y.jsx)(P.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:(0,y.jsx)("div",{className:"py-1",children:re.map(e=>(0,y.jsxs)("button",{onClick:()=>le(e.id),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm ".concat(F===e.id?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.icon," ",e.shortLabel||e.label]},e.id))})})})]})]})}),me]})]}),W&&(0,y.jsx)(h.S,{ticketId:G,onClose:()=>Z(!1)}),U&&(0,y.jsx)(A,{onClose:()=>Y(!1)})]})}}}]);
//# sourceMappingURL=843.5f97bed3.chunk.js.map